#! /usr/bin/env sh

# Retrieve current keymap
lang="$(setxkbmap -query | grep layout | tr -d ' ' | cut -f2 -d':')"

if [ $? -ne 0 ]; then
    echo "Error parsing keymap"
    exit 1
fi

# Toggle through keymaps
if   [ "$lang" = us ]; then lang="ca"; setxkbmap $lang
elif [ "$lang" = ca ]; then lang="us"; setxkbmap $lang
else setxkbmap us
fi

# Generate notification
text="$(echo $lang | tr '[:lower:]' '[:upper:]')"
notif                     \
    -n 1000               \
    -i "$(basename "$0")" \
    "ï„œ $text"

# Reload xmodmap
if command -v xmodmap > /dev/null && [ -f "$HOME/.Xmodmap" ]; then
    xmodmap "$HOME/.Xmodmap" > /dev/null
fi
